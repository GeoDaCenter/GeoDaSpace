%%%%% TITLE
\title{A Point Simulation Approach for Evaluating the Cluster Detection Capabilities of Local Network Statistics}
%%Assessing the Power of Local Network-Constrained Cluster Statistics: A Simulation Experiment
\author{Luc Anselin, Sergio Rey, Elizabeth A. Mack, Julia Koschinsky, Ran Wei}
%\affiliation{GeoDa Center for Geospatial Analysis and Computation, School of Geographical Sciences and Urban Planning, Arizona State University}
%\email{luc.anselin@asu.edu}   
\date{\today}


%%%%% PREAMBLE
\documentclass[12pt, letterpaper]{article}
\usepackage[top=1in, bottom=1in, left=1in, right=1in]{geometry}
\usepackage[pdftex]{graphicx}
\usepackage[round]{natbib}
\usepackage{fancyhdr}
\usepackage{setspace}
\usepackage{amsmath} 
\usepackage{titling}


%%%%% DOCUMENT
\begin{document}
\maketitle{}
\setstretch{1.5}
\newpage

\begin{abstract}

Despite advancements in spatial statistics for network-based phenomenon in recent years, several questions about these methods persist. One of these questions concerns the impact of the distribution of events on the cluster detection capability of these statistics. This study will evaluate the cluster detection power of local network statistics for a variety of simulated point patterns. Specifically, the network kernel density, the local k-function, and network versions of the local Moran and local G statistic will be evaluated under a variety of event distributions. Results demonstrate....... %we need to add these in here and a sentence about conclusions.

\end{abstract}
\newpage


\section{Introduction}

One of the simplifying assumptions made in studies of spatial phenomenon is that events are distributed on an isotropic plane in Euclidean space. This simplification ignores the fact that some phenomenon like traffic accidents, retail outlet locations, certain plant species, and certain kinds of crime, are more likely to occur on or near road networks, and thus behave differently than if they were distributed in Euclidean space. Critiques of the application of planar methods to network-constrained phenomenon state it is inappropriate because these events, by definition, may not be located anywhere in Euclidean space. Network events are actually constrained to a subset of continuous two-dimensional space \citep{yamada2004comparison, borruso2008network} and therefore, it is incorrect to treat them as continuously distributed phenomena. Another related critique of the uniform use of planar methods on network-constrained events is the fact it is physically impossible for some processes to occur off of the street network because of physical or legal constraints \citep{yamada2004comparison}. Finally, the use of planar methods in place of network methods confuses the definitions of proximity and accessibility. Two crash locations on a network may be spatially proximal, but the route on a street network a rescue vehicle travesl between the two crash locations may be dramatically different than their distance in Euclidean space \citep{yamada2004comparison}. 

In response to these critiques, statistical analyses of network-constrained phenomenon have evolved from the application of planar methods to network based phenomenon \citep{black1991highway, levine1995spatial, miller1994market, okabekitamura1996,kwan1998space,blackthomas1998, okabe2001computational} to the development of network specific statistics for network-based phenomenon. The development of network-specific methods recognizes the necessity for different treatments of network events compared to their Euclidean space counterparts. Innovations in network statistics include network Huff models \citep{miller1994market, okabekitamura1996, okabe2001computational}, network based kernel density methods  \citep{porta2009street, borruso2008network, xie2008kernel, okabe2009kernel}, local indicators of spatial association \citep{yamada2010local}, network k-functions \citep{okabeyamada2001, luchen2007false}, local network k-functions \citep{yamada2007local}, and network quadrat analysis \citep{shiode2008analysis}. These statistical innovations are particularly important given the inherent differences in network vs. Euclidean phenomenon. In fact, studies evaluating network-based methods demonstrate these methods produce visually different results than their planar counterparts \citep{yamada2004comparison, cheng2005experimental, downs2007characterising}.  

Despite recent developments in network-based methods, the cluster detection power of these methods remains under-explored, particularly in a simulation context. While prior applications of network methods have suggested situations under which their performance is likely to vary; the evaluation of results to date is primarily empirical. These studies suggest performance may be related to the characteristics of the street network and/or the underlying distribution of events \citep{yamada2004comparison, luchen2007false, borruso2008network}. This study is a first step towards exploring the circumstances under which the statistical power of these methods is likely to vary. %Link to cluster literature added here per conversation with Julia. 
The paper draws upon prior simulations evaluating the power of planar cluster statistics to examine the statistical power of network-based methods across two sources of variation. One, variation in the distribution of events. Two, variations in the characteristics of the underlying street network. In the analysis that follows, a simulation will be designed that evaluates the power of three network-based statistics for a variety of simulated point patterns and for five street networks with different characteristics. Specifically, the statistical power of the network kernel density function \citep{okabe2009kernel}, the network local k-function \citep{yamada2007local}, and the network local indicator of spatial association \citep{yamada2010local} will be examined. 

The remainder of this paper is organized as follows. Section two provides an overview of network analyses from a variety of disciplines including geography, mathematics, ecology, criminology, and marketing. Section three provides a brief review of power evaluations from the cluster literature, which are the basis for the simulation design in this study. Section four discusses the street network data and the simulated event data used in this study. Section five provides an overview of the simulation design, including the distribution of events under the null and alternative hypothesis. Section six contains a description of the three methods evaluated in this study while section seven discusses the results of the simulation and the cluster detection capabilities of the network statistics of interest. The study concludes in section eight with a discussion of extensions to this simulation and the practical implications of the results produced in this study.

\section{Network Constrained Phenomenon}

Although techniques, like the shortest-path algorithm, \citep{dijkstra1959note} used to estimate network-based statistics are rooted in mathematics and graph theory, the analysis of network-constrained events is relevant to a variety of disciplines including geography, ecology, epidemiology, communications studies, and engineering. For example, network-based statistics may be used to evaluate the spread of a contagious disease along public transportation routes. These statistics are also useful for plants found growing along transportation networks, like the Acacia plant \citep{spooner2004spatial}. Network-based market area demand models have also been utilized in the retail location literature \citep{okabe2001computational}. Perhaps one of the most common applications of these statistics is to examine clusters of traffic accidents on road networks \citep{yamada2004comparison} \citep{okabe2009kernel}.

While the utility of network-based methods is widespread, the statistical power of these approaches has rarely been benchmarked to simulated results. Hence little evidence beyond empirical examples exists to clarify the types of event patterns and street network characteristics for which these methods are more likely to produce Type II errors. In addition to uncertainty regarding the data characteristics for which these statistics have the most power, the impact of variations in the street network and the distribution of events on the cluster detection power of these statistics remain unexplored in a simulation context. Variations in the attributes of street networks, such as street network length, street length density, number of street segments, and street segment density are mentioned in the literature \citep{yamada2004comparison, luchen2007false}. However, the impact of other street network characteristics (connectivity, redundancy, and nodal accessibility) on the power of network-based statistics remain open areas for future research. The simulation analysis in this paper will evaluate the impact of varied point distributions and network characteristics on the cluster detection capabilities of three network statistics: the network kernel density function, the network local k-function, and the network LISA. 
	
\section{Cluster Statistic Simulations}

The basis for the simulation design in the present analysis of local network-constrained clusters is derived from the literature evaluating the statistical power of various cluster statistics. These studies evaluate a subset of over 100 test statistics that have been proposed to evaluate the deviation of point patterns from a random distribution \citep{kulldorff2006tests}. These studies may be subdivided in a number of ways based on the kinds of cluster statistics evaluated (global or local), the type of inputs into the simulation (empirical or simulated data), and the number of clusters used in the power evaluation. The goal of this study is to evaluate the ability of the three network statistics mentioned (network kernel density, network local k-function, network LISA) to accurately detect the number of clusters simulated. Therefore, studies evaluating the power of local or focused cluster statistics via simulated datasets are of particular interest for the purposes of this study. Table 1 contains the sample of studies considered in the simulation design.

Three aspects of the simulation designs in these studies were of particular interest for the simulation desing in the present study. One, the number of clusters evaluated in the study. Two,the method for creating the clusters. Three, the method for determining the strength of these clusters.  For example, Tango (1999) and Swartz (1998) evaluated the power of test statistics based on the location of a single cluster, while Getis and Aldstadt (2006) used multiple clusters to evaluate the capabilities of their AMOEBA statistic. A common feature of these studies is that the locations of these clusters as well as their relative strengths are typically specified a priori. A good example is the Kulldorff and Nagarwalla (1995) study, which placed a cluster in the center of a square of 100 cells and then distributed the disease cases amongst the cells so that the cell representing the ``true cluster'' had a relative risk that was \emph{rr} higher than all of the other cells. In a similar fashion, Rogerson (1999) elevated the risk of disease at a single point where the relative risk was defined to be three times higher than all of the other locations. The relative risk then declined exponentially from this designated point and locations with a resultant relative risk less than 1.5 were assigned a risk value of one.   

Additional analysis of the studies in Table 1 in this context reveals a great deal of variety in simulation designs. As mentioned previously, a common feature of these simulations is an a priori designation of the cluster center/s and a designation of relative risk throughout the study area and at the cluster locations. The simulation design in this study follows these power evaluations in its a priori designation of cluster locations and strengths. However, this study differs from these existing simulation studies and other network studies in two key ways. First, the simulation is designed for clusters located on a network and not clusters located in Euclidean space. Second, the simulation assigns events directly to the network and does not require observations be snapped to the network as do other studies of network-constrained phenomena \citep{borruso2008network, xie2008kernel, okabe2009kernel}.


\section{Data} 
%JK: Yes, I will select several representative street patterns and can write this paragraph.
Street network data utilized in this study pertain to the city of Mesa, which is located to the east of Phoenix, Arizona. Mesa is a medium-sized city in the Phoenix metropolitan statistical area (Figure 1) %Do we want to include this graphic for thoroughness? with a population of about 460,000 as of 2009 (U.S. Census Bureau, 2010). %Do we want to use a segment of Mesa or the whole street network? %Do we want to provide any comparative metrics on this street network from GeoDaAccess?% 
These data were obtained from the GIS Data Repository of Arizona State University (2010). The data points assigned to the street network are a function of the simulation design, which will be discussed in the next section.

\section{Simulation Design}
The simulation in this paper opts for the use of simulated rather than empirical data. This selection is made because the use of simulated data allows one to know the true data generation process, and the type of clustering present in the data  \citep{kulldorff2006cancer}. This is not the case with empirical data and therefore it is more difficult to evaluate the clustering process present in these data (ibid) and the subsequent power of the statistics of interest. Before discussing the details of the simulated data in the present study however, it is necessary to discuss some of the necessary pre-processing of the street network in preparation for the simulation.

\subsection{Preparation of Street Network Information}
Although the street networks used in the study are not simulated, it was necessary to perform two operations on each of the street datasets to prepare them for use with the simulated events dataset. First, calculate the length of each street within the street network dataset. Second, assign each street a unique identifier so that the streets may be ordered, and the simulated points assigned accordingly. Once these initial calculations are made, it is possible to assign each street a probability based on its length, in proportion to the total length of all the streets in the network. The steps to do this are as follows:

\emph{Step 1}: Obtain the total length of all the streets in the network.

\emph{Step 2}: Calculate the \emph{proportional length} of each street. This is obtained by dividing the length of the street by the total length of all the streets in the network.

\emph{Step 3}: Assign a probability to each street segment based on its cumulative proportional length. This is done by ordering the streets according to their unique identifiers, and then calculating the cumulative proportional length for each street. For example, the cumulative proportional length for the street with a unique identifier of three is the sum of the proportional lengths of streets one, two, and three. To obtain the probability for street 100, the proportional lengths of streets 1 through 99 are added. This step results in streets laid end to end, according to their unique identifiers, on an imaginary line starting at 0 and ending at 1, with a corresponding probability for each equal to their proportional length.

At the end of the preparation of the street network data, each street segment will have the following key attributes: a length, a unique id, a proportional length, and a probability. The first three attributes in this list were key inputs to obtain the probability of each street. The probability assigned to each street will be the means by which points are matched directly to the network.

\subsection {Null Hypothesis}
The distribution of observations under the null hypothesis is random. 1,600 random numbers between 0 and 1 are generated from a uniform distribution. The random numbers are then matched to the streets in the network according to their correspondence with the calculated probability of the street. After matching events to the streets, the events are then located on that street in proportion to their distance on the imaginary 0 to 1 line generated by connecting all the streets in the network end to end. For example, if an event with a probability value of 0.65 is matched to a street that begins at a point with a probability value of 0.60 and terminates at a point with a probability value of 0.70, that point consumes 50\% of the length of that particular street. Accordingly, that point with a probability value of 0.65 should be placed on its corresponding street so that is consumes approximately 50\% of the total length of that street. A count of the number of events on the street concludes the distribution of points under the null hypothesis.

Although the additional step of placing points in specific locations on the component streets of the network is not relevant for the LISA results produced in this paper, it is important in the estimation of the network kernel density function and the network local k-function. While the network LISA statistics are based upon event counts on network segments, both the network kernel density and the local k-function are computed based on individual point locations. Therefore, it is paramount to locate events at specific points on the streets instead of stacking them in the center of the streets; such an approach would not provide any information about the density of events on the individual streets of the network. %Anything else here?

\subsection {Alternative Hypothesis}
The process for generating the distribution of points under the alternative hypothesis, which allows for multiple clusters of points, is similar to the process for distributing the points under the null hypothesis, with a few important exceptions. Before randomly assigning points to the network , it is necessary to separate out the streets that will serve as the cluster centers. These streets will not be the recipient of any random points and must therefore be eliminated from the set of street segments that will randomly receive points. First, it is necessary to identify the locations of these clusters, per the precedent set by power evaluations of planar cluster statistics discussed in the previous section. To do this, the street network of interest is divided into four quadrants and a street segment selected in each of these quadrants to serve as the cluster center. These four streets will be the recipients of some percentage of the 1600 points. To start, 10\% of the 1600 points, will be assigned to these segments. Before assigning points to these clusters however, 90\% of the points, or 1,440 points, are randomly assigned to the set of remaining street segments. This step essentially replicates the random assignment of points to the network per the process described for the null hypothesis. The one addition to the process is that unique ids are reassigned to the streets so that they may be ordered properly after the removal of the streets serving as cluster centers. Once the random assignment of points is made, the remaining 10\% of points, or 160 points are allocated evenly amongst the four clusters. 

Modifications to the locations of the four clusters and the strengths of the four clusters are considered for the alternative hypothesis. The locations of the four clusters are varied so that four scenarios are considered:

\emph{Scenario 1}: One cluster per quadrant.

\emph{Scenario 2}: One cluster per quadrant and two clusters in quadrant I.

\emph{Scenario 3}: Two clusters in quadrants I and III.

\emph{Scenario 4}: Three clusters in quadrant II and one cluster in quadrant III.
%How many different scenarios do we want to consider here? %Is this enough or do we want to consider all possible configurations?
%JK: Why don't we start with this and check the results
%JK: Let's present this in Figure format and then say, "so that four scenarios are considered as in Figure x"

In addition to considering each of the four scenarios detailed above, five different cluster strengths will be considered for each of the scenarios. The cluster strength in the alternative hypothesis corresponds to the percent of all observations assigned to clusters, where the larger the proportion of observations assigned to the clusters corresponds to stronger clusters. Proportions of 10\%, 20\%, 30\%, 40\%, and 50\% will be considered for each of the four scenarios for a total of 20 different combinations of cluster locations and cluster strengths. These 20 combinations will be applied to each of the five street networks of interest to see how the power of the three statistics of interest also varies with different street network characteristics.  


\section{Methods}
This paper evaluates three kinds of network-based statistics in regards to their statistical power to detect clusters: the network kernel density function, the network local k-function, and the network versions of the local Moran \citep{Anselin 1995} and the Getis and Ord local G statistic \citep{getisord1992distance}. The principal difference between these methods and their more commonly used planar counterparts is that clusters are computed within network constraints rather than without such constraints. The incorporation of network constraints however does present challenges, especially as the complexity of the network increases. 

\subsection{Network Kernel Density Estimation Method}
The specification of the network kernel density function is based on the formulation developed by  \citep{okabe2009kernel}. This kernel density estimation method is discontinuous at each node on the network and assigns the value of the kernel function to all links equally at each node along the shortest path (p) from location x to location y \citep{okabe2009kernel}. The equal-split non-continuous kernel function specified in this paper is used for two reasons. One, other network kernel function options, like the similar-shape kernel function, are biased \citep{okabe2009kernel}. Two, of the unbiased kernel functions mentioned in the study, the computational and practical considerations recommend the non-continuous version of the equal-split kernel function over the continuous version. Not only does implementation of the continuous version of the equal-split function require the consideration of many special cases, but it also requires more time to compute the results. Okabe et al. (2009) found the computation time for the continuous version of the equal-split function increased rapidly for bandwidths greater than 200m.     

\subsection{Network Local k-function}
The network local k-function developed by \citep{yamada2007local} is based on the planar local k-function developed by Getis and Franklin (1987) and the representative location approach utilized by Openshaw et al. (1987) in their Geographical Analysis Machine (GAM) analyses. The statistic computes the number of observations within a pre-specified network distance \emph{h} of a reference point \citep{yamada2007local} and is considered a departure from its planar counterpart because it examines clustering around reference points and not event locations \citep{yamada2007local}. It is important to note that unlike the network local Moran and local G statistic discussed in this piece, the network local k-function is not a local indicator of spatial association (LISA) because of its use of reference points and not actual event locations to detect local clusters. This prevents the sum of local indicators from summing to the global k-function, proportional to some constant. \citep{yamada2007local}

\subsection{Network Local Indicators of Spatial Association (LISAs)}
The network versions of the local Moran (ILINCS) and the local G statistic (GLINCS) \footnote[1]{Please see \citet{anselin1995local} and \citet{getisord1992distance} for the specification and a more thorough discussion of these statistics.} used in this paper, are extensions of the LINCS (local indicators of network-constrained clusters) framework developed in \citet{yamada2007local}. The computation of these statistics is much the same as for their planar counterparts. However, an important difference is the incorporation of a network-based weights matrix in the calculation of the two statistics. This weights matrix, in its simplest form, may reflect the connectivity between two links or streets on the network, where a 1 represents that two links (i and j) share a node \citep{yamada2010local}. A more complex version of a network weights matrix might compute the network distance between two nodes on a network \citep{yamada2010local}, as designated by the shortest path distance between the two nodes. As per their planar counterparts, these statistics are best used in conjunction with one another. Both decompose the global Moran \citep{moran1948interpretation} and the global G statistic \citep{getisord1992distance}, respectively, to uncover local "pockets" of spatial dependence that may be overlooked when using global statistics \citep{getis2010analysis}. %Any more here? %Am not sure how much detail we need to repeat about these statistics.

\section{Results}
-we will need to mention bandwidth for the network kernel density function here.

\section{Discussion and Conclusion}

%%%%%BIBLIOGRAPHY
\newpage
\setstretch{1.0}
\bibliographystyle{apalike}
\bibliography{Paper1_Simulation.bib}

\end{document}

